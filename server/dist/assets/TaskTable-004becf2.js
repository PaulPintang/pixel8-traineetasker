import{r as d,h as _,J as X,a5 as K,n as e,M as W,m as s,G as x,T as a,N as E,F as T,o as z,w as Y,B as A,a6 as Z,v as Q,a7 as ee,i as le,a8 as te,j as se,l as ae,U as ne,L as h,A as ie,a9 as ce,C as re,E as oe,p as de,q as he}from"./index-a5ac19d2.js";import{l as ge,H as me,I as pe,P as xe}from"./lodash-96b36927.js";import{I as L,G as ue,S as fe}from"./GettingData-d8ae6ec6.js";import{I as be}from"./IconDots-b03f8873.js";import{I as ye}from"./IconUser-6e23f3a0.js";const we=({task:c,assign:u,toggle:g})=>{const[b,m]=d.useState(""),{user:t}=_(n=>n.auth),{data:r}=X(t==null?void 0:t.course),[y,{isLoading:w}]=K(),f=async n=>{Z(t==null?void 0:t.course,t==null?void 0:t.role),m(n);const N={_id:c._id,name:n,course:t==null?void 0:t.course};await y({task:N,rooms:[t==null?void 0:t.course]}),Q("Task successfully assigned","success"),g()};return e(W,{size:"md",opened:u,onClose:g,title:s(x,{spacing:8,children:[e(a,{fz:"sm",className:"text-gray-500 font-semibold",children:"Task:"}),e(a,{fz:"sm",c:"dimmed",children:c.taskname})]}),centered:!0,children:e("div",{className:"space-y-2",children:e(E,{spacing:9,p:8,children:s(T,{children:[e(a,{fz:"sm",fw:"bold",children:"Members"}),r==null?void 0:r.map(n=>s(z,{justify:"space-between",align:"center",children:[s(x,{spacing:10,children:[e(Y,{src:n.picture,width:35,radius:"xl",imageProps:{referrerPolicy:"no-referrer"}}),s("div",{className:"-space-y-[2px]",children:[e(a,{size:"sm",children:n.name}),e(a,{c:"dimmed",size:"xs",children:n.email})]})]}),e(A,{size:"xs",variant:"white",onClick:()=>f(n.name),loading:w&&b===n.name,disabled:c.assign===n.name,children:"Assign"})]},n._id))]})})})})},Ie=({trainee:c,view:u,setViewId:g})=>{var M;const b=ee(),{pathname:m}=b,{user:t}=_(l=>l.auth),[r,y]=d.useState(""),[w,f]=d.useState(!1),{data:n,refetch:N}=le(),[j,{isLoading:k}]=te(),[q,{toggle:C}]=se(),[I,B]=d.useState(1),[$,H]=d.useState({}),[p,S]=d.useState("");d.useEffect(()=>{r&&N().then(()=>f(!1))},[r]);const v=n==null?void 0:n.filter(l=>{var i;return(i=l.taskname)==null?void 0:i.toLowerCase().includes(p.toLowerCase())}),o=v==null?void 0:v.filter(l=>r?l.status===r:c?c.name===l.assign:l),J=async l=>{await j({_id:l,rooms:[t==null?void 0:t.course]}),Q("Task deleted successfully","success")},D=ge.chunk(o,10),R=(M=D[I-1])==null?void 0:M.slice().sort((l,i)=>i.timeline.createdAt.localeCompare(l.timeline.createdAt)).map(l=>{var P,F,G;const i=(P=c==null?void 0:c.timesheet)==null?void 0:P.find(V=>V.status==="recording"),U={status:i==null?void 0:i.status,morning:i==null?void 0:i.morning,afternoon:i==null?void 0:i.afternoon},{spent:Ne,totalSpentString:O}=ae(U);return s("tr",{children:[e("td",{className:" md:table-cell lg:table-cell pl-3 pt-2",children:s(a,{children:[e("span",{className:"hidden md:flex lg:flex",children:(F=l.timeline)==null?void 0:F.createdAt}),e("span",{className:"flex md:hidden lg:hidden",children:(G=l.timeline)==null?void 0:G.createdAt})]})}),e("td",{className:"hidden md:table-cell lg:table-cell  pt-2",children:e(a,{children:e(me,{highlightColor:"cyan",highlight:p,children:l.taskname})})}),e("td",{className:"hidden md:table-cell lg:table-cell  pt-2",children:s(a,{children:[c&&e("span",{children:l.status==="inprogress"&&l.spent===""?e("span",{children:O}):l.spent}),!c&&l.ticketno]})}),m.includes("profile")?"":e("td",{className:"hidden md:table-cell lg:table-cell  pt-2",children:l.assign?e(a,{children:l.assign}):e(ne,{color:"teal",size:"md",variant:"dot",className:"text-gray-500",children:"Available Task"})}),e("td",{className:" md:table-cell lg:table-cell  pt-2",children:s(z,{className:"rounded bg-gray-50 max-w-max px-2 py-1 gap-2",align:"center",children:[e("div",{children:e("div",{className:`p-1 ${l.status==="new"?"bg-indigo-300":l.status==="inprogress"?"bg-violet-400":l.status==="completed"?"bg-green-300":l.status==="forqa"?"bg-yellow-300":"bg-red-300"}`})}),e(a,{fw:"bold",className:`text-[11px] ${l.status==="new"?"text-indigo-300":l.status==="inprogress"?"text-violet-400":l.status==="completed"?"text-green-300":l.status==="forqa"?"text-yellow-300":"text-red-300"}`,children:l.status})]})}),e("td",{className:" md:table-cell lg:table-cell  pt-2",children:(t==null?void 0:t.role)==="supervisor"||(t==null?void 0:t.role)==="admin"?e(A,{onClick:()=>{u(),g(l._id)},leftIcon:e(L,{size:16,className:"hidden md:flex lg:flex"}),variant:"white",color:"cyan",size:"xs",children:"View"}):s(h,{shadow:"md",transitionProps:{transition:"rotate-right",duration:150},closeOnItemClick:!0,withArrow:!0,children:[e(h.Target,{children:e(ie,{variant:"white",color:"cyan",children:e(be,{size:19})})}),s(h.Dropdown,{children:[e(h.Label,{children:"Manage task"}),s(E,{spacing:9,py:5,align:"center",className:"w-full",children:[e(h.Item,{className:"bg-white hover:bg-white",py:0,onClick:()=>{u(),g(l._id)},icon:e(L,{size:16}),children:e(a,{fz:"xs",fw:"bold",c:"dark",children:"View"})}),l.status==="new"&&((t==null?void 0:t.role)==="Task manager"||(t==null?void 0:t.role)==="QA Personnel"||m.includes("profile")?e(h.Item,{className:"bg-white hover:bg-white",py:0,onClick:()=>{H(l),C()},icon:e(ye,{size:16}),color:l.assign?"indigo":"cyan",children:e(a,{fz:"xs",fw:"bold",children:l.assign?"Reassign":"Assign"})}):null),(t==null?void 0:t.role)!=="QA Personnel"&&(l==null?void 0:l.status)==="new"&&e(A,{leftIcon:e(ce,{size:16}),variant:"white",size:"xs",color:"red",onClick:()=>{J(l._id)},loading:k,compact:!0,mr:5,children:"Delete"})]})]})]})})]},l._id)});return s(T,{children:[s(re,{className:"bg-opacity-60 rounded-md shadow-md h-[calc(100vh-170px)] mt-4",children:[e("div",{className:"h-[94%] overflow-",children:s("table",{className:"border-collapse border-none w-full",children:[e("thead",{children:s("tr",{children:[e("th",{scope:"col",className:"md:px-3 lg:px-3 pl-3 py-3 text-left text-[9px] font-[600] text-gray-400   tracking-wider  bg-gray-100 shadow-sm rounded-tl-md",children:e(a,{children:"Date Added"})}),e("th",{scope:"col",className:"hidden md:table-cell lg:table-cell  py-3 md:pr-3 lg:pr-3 text-left text-[9px] font-[600] text-gray-400   tracking-wider  bg-gray-100 shadow-sm",children:e(a,{children:"Task Name"})}),e("th",{scope:"col",className:"hidden md:table-cell lg:table-cell py-3 text-left text-[9px] font-[600] text-gray-400   tracking-wider bg-gray-100 shadow-sm",children:e(a,{children:c?"Total spent":"Ticket no."})}),!m.includes("profile")&&e("th",{scope:"col",className:"hidden  md:table-cell lg:table-cell py-3 text-left text-[9px] font-[600] text-gray-400   tracking-wider bg-gray-100 shadow-sm",children:e(a,{children:"Assigned to"})}),e("th",{scope:"col",className:"  md:table-cell lg:table-cell py-3 text-left text-[9px] font-[600] text-gray-400   tracking-wider bg-gray-100 shadow-sm",children:e(a,{children:"Status"})}),e("th",{scope:"col",className:"md:px-3 lg:px-3 pl-3 py-3 text-left text-[9px] font-[600] text-gray-400   tracking-wider  bg-gray-100 shadow-sm rounded-tr-md",children:e(a,{children:"Action"})})]})}),w&&r?e(ue,{}):e(T,{children:(o==null?void 0:o.length)===0?e(oe,{text:p===""?`There are no ${r} tasks`:"Task not found"}):e("tbody",{className:"text-sm text-gray-600",children:R})})]})}),s(z,{justify:"space-between",children:[s(x,{align:"center",spacing:10,children:[e(de,{rightSection:p?e(he,{onClick:()=>S(""),size:14,className:"hover:cursor-pointer text-gray-500 hover:text-gray-800 transition-all"}):e(pe,{size:14,className:"text-gray-500"}),size:"xs",placeholder:"Search",value:p,onChange:l=>S(l.currentTarget.value)}),e(fe,{size:"xs",value:r,onChange:l=>{f(!0),y(l)},w:150,placeholder:"Filter",data:[{value:"",label:"All tasks"},{value:"new",label:"New"},{value:"inprogress",label:"In-Progress"},{value:"forqa",label:"For-QA"},{value:"failed",label:"Failed"},{value:"completed",label:"Completed"}]})]}),s(x,{children:[s(x,{spacing:3,children:[e(a,{fz:"xs",className:"uppercase font-semibold text-gray-700",children:"Total:"}),s(a,{fz:"xs",children:[o==null?void 0:o.length," task",(o==null?void 0:o.length)>=2&&"s"]})]}),e(xe,{total:D.length,value:I,onChange:B,size:"xs",color:"cyan",withEdges:!0})]})]})]}),e(we,{task:$,assign:q,toggle:C})]})};export{Ie as default};
