import{l as X,O as Y,o as Z,H as $,Q as ee,m as te,r as ne,J as f,x as ae,i as n,j as e,T as z,q as w,G as y,K as c,A as le,F as d,S as B,L as se,B as R,C as ie}from"./index-24d6de80.js";import{l as oe,E as ce,P as re}from"./EmptyState-e33e9fa9.js";import{I as N}from"./IconClock-d6a0d0e1.js";import{I as de}from"./IconDots-63fcfa75.js";const he=()=>{const i=new Date().getHours();let a=null;return i>=0&&i<12?a="morning":i>=12&&i<18&&(a="afternoon"),a},fe=({profile:i})=>{var L,P,C,O,j;const{user:a}=X(t=>t.auth),[_,{isLoading:v}]=Y(),{data:o,refetch:q}=Z(),{data:T,isLoading:me}=$(i==null?void 0:i.course,{skip:(a==null?void 0:a.role)==="trainee"}),[J,ge]=ee(),k=T==null?void 0:T.find(t=>t._id===(i==null?void 0:i._id)),{data:r}=te(),m=new Date,g=m.getHours();he();const u={morning:{in:8,out:12},afternoon:{in:13,out:17}},[D,K]=ne.useState(1),A=async()=>{var h;await _();const t=(h=o==null?void 0:o.timesheet)==null?void 0:h.some(s=>s.date===f(m.toISOString()).date),I=r==null?void 0:r.some(s=>s.status==="inprogress");if(!t&&I){const s=r==null?void 0:r.filter(b=>b.status==="inprogress"),x={task:s==null?void 0:s[0].taskname,ticket:s==null?void 0:s[0].ticketno};await J({sheet:x,rooms:[a==null?void 0:a.course]})}q()},p=(a==null?void 0:a.role)==="trainee"?o==null?void 0:o.dtr:k==null?void 0:k.dtr,S=oe.chunk(p,10),l=(L=o==null?void 0:o.dtr)==null?void 0:L.find(t=>t.date===f(m.toISOString()).date);ae("DailyTimeRecords");const U=(P=S[D-1])==null?void 0:P.map((t,I)=>{var h,s,x,b,E,G,H,M,Q,F;return n("tr",{className:"border-none ",children:[e("td",{className:" md:table-cell lg:table-cell pl-3",children:e(z,{children:f(t.date).date===m.toDateString()?"Today":f(t.date).date})}),e("td",{className:"hidden md:table-cell lg:table-cell",children:e(w,{children:n(y,{spacing:8,children:[e(N,{size:16,className:"text-yellow-400"}),e("span",{children:(h=t.morning)==null?void 0:h.in})," -"," ",e("span",{children:(s=t.morning)==null?void 0:s.out})]})})}),e("td",{className:"hidden md:table-cell lg:table-cell",children:e(w,{children:n(y,{spacing:8,children:[e(N,{size:16,className:"text-violet-400"}),e("span",{children:(x=t.afternoon)==null?void 0:x.in})," -"," ",e("span",{children:(b=t.afternoon)==null?void 0:b.out})]})})}),e("td",{className:"py-2  md:table-cell lg:table-cell ",children:e(z,{fw:"bold",fz:"xs",children:t.status})}),e("td",{className:"py-2 table-cell  md:hidden lg:hidden ",children:n(c,{shadow:"md",transitionProps:{transition:"rotate-right",duration:150},withArrow:!0,children:[e(c.Target,{children:e(le,{variant:"white",color:"cyan",children:e(de,{size:19})})}),n(c.Dropdown,{children:[((E=t.morning)==null?void 0:E.in)!==""&&n(d,{children:[e(c.Label,{children:"Morning"}),e(c.Item,{p:0,className:"bg-white hover:bg-white",children:e(B,{px:10,pb:5,spacing:1,children:n(y,{spacing:8,className:"text-xs",children:[e(N,{size:16,className:"text-yellow-400"}),e("span",{children:(G=t.morning)==null?void 0:G.in})," -"," ",e("span",{children:(H=t.morning)==null?void 0:H.out})]})})}),e(c.Divider,{})]}),((M=t.afternoon)==null?void 0:M.in)!==""&&n(d,{children:[e(c.Label,{children:"Afternoon"}),e(c.Item,{p:0,className:"bg-white hover:bg-white",children:e(B,{px:10,pb:5,spacing:1,children:n(y,{spacing:8,className:"text-xs",children:[e(N,{size:16,className:"text-violet-400"}),e("span",{children:(Q=t.afternoon)==null?void 0:Q.in})," -"," ",e("span",{children:(F=t.afternoon)==null?void 0:F.out})]})})})]})]})]})})]},I)}),V=!l&&u.morning.in===g?!0:((C=l==null?void 0:l.afternoon)==null?void 0:C.in)===""&&u.afternoon.in===g,W=((O=l==null?void 0:l.morning)==null?void 0:O.out)===""&&u.morning.out===g?!0:((j=l==null?void 0:l.afternoon)==null?void 0:j.out)===""&&u.afternoon.out===g;return n(d,{children:[n(w,{justify:"space-between",align:"center",pb:6,children:[e(se,{}),(a==null?void 0:a.role)==="trainee"&&e(d,{children:!l||(l==null?void 0:l.status)!=="recorded"?n(d,{children:[V?e(R,{color:"yellow",size:"xs",onClick:A,loading:v,children:"Time in"}):"",W?e(R,{color:"indigo",size:"xs",onClick:A,loading:v,children:"Time out"}):""]}):""})]}),n(ie,{className:"bg-opacity-60 rounded-md shadow-md h-[calc(100vh-160px)]",children:[e("div",{className:"h-[96%]",children:n("table",{className:"border-collapse border-none w-full",children:[e("thead",{children:n("tr",{children:[e("th",{scope:"col",className:" md:px-3 lg:px-3 pl-3 py-3 text-left text-[12px] font-[600] text-gray-400 tracking-wider  bg-gray-100 shadow-sm rounded-tl-md",children:"Date"}),e("th",{scope:"col",className:"hidden  md:table-cell lg:table-cell rounded-tl-md md:rounded-none lg:rounded-none py-3  md:pr-3 lg:pr-3 text-left text-[12px] font-[600] text-gray-400 tracking-wider  bg-gray-100 shadow-sm",children:"Morning"}),e("th",{scope:"col",className:"hidden md:table-cell lg:table-cell py-3 text-left text-[12px] font-[600] text-gray-400 tracking-wider bg-gray-100 shadow-sm rounded-tr-md lg:rounded-none",children:"Afternoon"}),e("th",{scope:"col",className:"  md:table-cell lg:table-cell  py-3 text-left text-[11px] font-[600] text-gray-400   tracking-wider  bg-gray-100 shadow-sm lg:rounded-tr-md rounded-none",children:"Status"}),e("th",{scope:"col",className:"  md:hidden lg:hidden table-cell  py-3 text-left text-[11px] font-[600] text-gray-400   tracking-wider  bg-gray-100 shadow-sm rounded-tr-md"})]})}),(p==null?void 0:p.length)===0?n(d,{children:[e(ce,{text:"No records found"}),";"]}):e("tbody",{className:"text-xs text-gray-600",children:U})]})}),n(w,{justify:"space-between",children:[n(z,{c:"dimmed",fz:"xs",children:["Page ",D," of ",S.length]}),e(re,{total:S.length,value:D,onChange:K,size:"xs",color:"teal",withEdges:!0})]})]})]})};export{fe as default};
